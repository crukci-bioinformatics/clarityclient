<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M3 from src/site/markdown/automation.md at $dateFormat.format( $currentDate )

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M3" />
    <title>CRUK-CI Genologics API Client &#x2013; Process Automation</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: $dateValue</span>
           | <span id="projectVersion">Version: 2.31.ee8.2</span>
      </div>
      <div class="xright">      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>User Guide</h5>
    <ul>
     <li class="none"><a href="index.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="installing.html" title="Installation">Installation</a></li>
     <li class="expanded"><a href="usageoverview.html" title="Usage">Usage</a>
      <ul>
       <li class="none"><a href="spring.html" title="Spring Configuration">Spring Configuration</a></li>
       <li class="none"><a href="usage.html" title="Basic Usage">Basic Usage</a></li>
       <li class="none"><a href="caching.html" title="Caching">Caching</a></li>
       <li class="none"><a href="serverside.html" title="Server Deployment">Server Deployment</a></li>
       <li class="none"><strong>Process Automation</strong></li>
      </ul></li>
     <li class="none"><a href="issues.html" title="Known Issues">Known Issues</a></li>
     <li class="none"><a href="references.html" title="Reference Documentation">Reference Documentation</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
    <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
      <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
    </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section><section>
<h2><a name="Process_Automation"></a>Process Automation</h2>
<p>The Clarity Automation package provides a set of classes for running a process
through the Clarity API as if it were being run by a technician progressing the
process through the Clarity web pages. It is a general package to help programs that
need to run protocol steps automatically.</p><section>
<h3><a name="Spring_Configuration"></a>Spring Configuration</h3>
<p>The main class of the library, <code>ClarityProcessAutomation</code>, can be used
as a simple Java class (just create an instance) or can be injected into other
classes by Spring. There is a bean definition in <code>clarity-client-context.xml</code>
with the id <code>clarityAutomation</code>.</p></section><section>
<h3><a name="Basic_Usage"></a>Basic Usage</h3>
<p>The utility will help with moving a process through the screens one would otherwise
see in Clarity, waiting for the step to advance. Typically one would do the following
to run a protocol step from beginning to end.</p><section>
<h4><a name="Start_the_Process"></a>Start the Process</h4>
<p>The <code>beginProcessStep</code> method starts a process. It needs to be given a completed
<a href="https://d10e8rzir0haj8.cloudfront.net/6.0/data_stp.html#step-creation" class="externalLink"><code>StepCreation</code></a>
object, which will provide the inputs to the process (which must be in the step's queue)
and the container type the outputs will be put into. If all is well, the call will return
a <a href="https://d10e8rzir0haj8.cloudfront.net/6.0/data_stp.html#step" class="externalLink"><code>ProcessStep</code></a> object.</p></section><section>
<h4><a name="Wait_for_the_Process_to_have_started"></a>Wait for the Process to have started</h4>
<p>When a process is started there may be EPP scripts triggered before the process can
be manipulated. It is typically EPP scripts that cause the wait between step changes.
One should call the <code>waitUntilProcessInState</code> method, which will poll Clarity
until the process moves into the state requested (or times out waiting for it). Client
code can then progress.</p>
<p>One has to be careful about which states a process goes through. Some steps begin with
the <em>Record Details</em> screen, but others may go through other stages before that such as
<em>Placement</em> or <em>Pooling</em>. The client code should know which step it is automating so the
author will know which stages the specific process type has.</p></section><section>
<h4><a name="Manipulate_the_Process"></a>Manipulate the Process</h4>
<p>Once in the right state, you can use the API methods to update artifacts and the process
as you wish.</p></section><section>
<h4><a name="Move_to_the_next_stage"></a>Move to the next stage</h4>
<p>This is a repeat of starting the process: calling <code>waitUntilProcessInState</code> with
the next stage of the process as the status. One will need to do this for every stage
of the process until it is in the <em>Assign Next Steps</em> state.</p></section><section>
<h4><a name="Completing_the_Process"></a>Completing the Process</h4>
<p>When the process gets to <em>Assign Next Steps</em> one has to fill in the <code>Actions</code> object
with what to do with the output artifacts. This is also protocol specific, as it might
be that the protocol finishes or there are one or more steps left to do. Sometimes there
may be a choice of next steps. This is step specific and can't be documented here save
to say that the choice is made by updating the <code>Actions</code> object for the process step.</p></section></section><section>
<h3><a name="Automating_EPP_Execution"></a>Automating EPP Execution</h3>
<p>The utility also provides the method <code>waitUntilProgramCompletes</code> that performs a
similar poll until finished mechanism for EPP programs. These are the EPPs that would
be launched by a click on a button on the <em>Record Details</em> screen rather than automatically
triggered by Clarity.</p><section>
<h4><a name="Start_the_EPP"></a>Start the EPP</h4>
<p>The <code>startProgram</code> method starts an EPP. It needs to be given an <code>AvailableProgram</code>
object, a list of those available being held in the <code>ProcessStep</code> object.</p></section><section>
<h4><a name="Wait_for_the_EPP_to_finish"></a>Wait for the EPP to finish</h4>
<p>The <code>waitUntilProgramCompletes</code> method should then be called. This is simpler than
its process equivalent as there are no steps to its progression, just a wait for the
EPP to finish. The <code>ProgramStatus</code> object returned from the <code>startProgram</code> call
is updated in place with information about the EPP's execution, and an exception thrown
if the EPP fails or if the time limit is exceeded for it to finish.</p></section></section></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2013&#x2013;${currentYear}<a href="https://www.cruk.cam.ac.uk/">Cancer Research UK Cambridge Institute</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
